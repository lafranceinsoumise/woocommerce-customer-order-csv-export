"use strict";!function(){var j={}.hasOwnProperty;jQuery(function(c){var n,e,o,r,a,d,i,s,_,t,l,u,p={},m=c.WCBackboneModal.View,f=function(o,r,n,a,c,d){var i,s,_=o.length;return c=c||25,d=d||_,s=0,i=function(){for(var e=+new Date,t=s;s<_&&s-t<d&&new Date-e<50;)r.call(n,o[s]),s+=1;return s<_?setTimeout(i,c):a(o)},setTimeout(i,25)},v=function(e){var r={},t=function(e,t){var o;t.name=t.name.replace("[]",""),null!=(o=r[t.name])?c.isArray(o)?o.push(t.value):r[t.name]=[o,t.value]:r[t.name]=t.value};return c.each(c(e).serializeArray(),t),r},w=function(e){return c("#wc-backbone-modal-dialog .modal-close").trigger("click"),e.button_class=e.button_class||"",new m({target:"wc-customer-order-csv-export-modal",string:e})},h=function(e,t){var r;return t=t||{},r={action:"wc_customer_order_export_create_export",security:wc_customer_order_csv_export_admin.create_export_nonce,export_type:t.export_type||"orders",export_method:t.export_method||"download",output_type:t.output_type||"csv",export_format:t.export_format||"default",automation_id:t.automation_id||"",filename:t.filename||"",mark_as_exported:null==t.mark_as_exported||t.mark_as_exported,add_notes:t.add_notes,batch_enabled:t.batch_enabled,export_query:e},t=wp.template("wc-customer-order-csv-export-modal-body-export-started"),w({title:wc_customer_order_csv_export_admin.i18n.export_started,body:t({export_method:r.export_method,batch_enabled:r.batch_enabled}),action:r.batch_enabled?wc_customer_order_csv_export_admin.i18n.cancel:wc_customer_order_csv_export_admin.i18n.close,button_class:r.batch_enabled?"cancel-export":"",batch_enabled:r.batch_enabled}),c.post(ajaxurl,r).done(function(t){var o;if(c("#wc-backbone-modal-dialog").length)return!1===t.success?y({title:t.data.title,message:t.data.message}):(c("#wc-backbone-modal-dialog").addClass("wc-customer-order-csv-export-"+t.export_id).data("wc-customer-order-csv-export-id",t.export_id),r.batch_enabled?b(t.export_id):(o=!1,p[t.export_id]=setInterval(function(){if(!o)return o=!0,c.get(t.status_url).done(function(e){return"string"==typeof e?y():(o=!1)===e.success?(k(t.export_id),y(e.data)):"completed"===e.data.status?g(e.data):void 0}).fail(function(e,t,o){return y()})},2e3)))}).fail(function(e,t,o){return y()})},x=function(e){var t,o,r=wp.template("wc-customer-order-csv-export-modal-body-export-started");return w({title:wc_customer_order_csv_export_admin.i18n.export_resumed,body:r({export_method:"download"})}),t=c(".file_actions .resume[data-export-id="+e+"]").parents("tr"),(o=t.find(".export_status mark")).removeClass("paused").addClass("processing"),t.find(".file_actions .resume").addClass("disabled").attr("href","").blur(),t.find(".file_actions .cancel").removeClass("cancel").addClass("delete"),b(e).then(function(e){return o.removeClass("processing").addClass(e),t.find(".file_actions .resume").removeClass("disabled").removeClass("resume").addClass("download")})},b=function(t){return window.onbeforeunload=function(){return wc_customer_order_csv_export_admin.i18n.confirm_export_cancel},c(document).on("wc_customer_order_export_background_export_batch_progress_"+t,function(e,t){return c(".wc-customer-order-csv-export-progress").val(t.percentage)}),c(document).on("click","#btn-ok.cancel-export",function(e){if(confirm(wc_customer_order_csv_export_admin.i18n.confirm_export_cancel))return window.onbeforeunload=null,wc_customer_order_export_background_export_batch_handler.cancelled=t}),wc_customer_order_export_background_export_batch_handler.process_job(t).then(function(e){return window.onbeforeunload=null,c(".wc-customer-order-csv-export-progress").val(100),g(e.data)}).catch(function(e){return c(".wc-customer-order-csv-export-progress").hide(),y(e.data)})},g=function(e){var t;if("download"===e.method||"local"===e.method||"completed"===e.transfer_status)return t=wp.template("wc-customer-order-csv-export-modal-body-export-completed"),w({title:wc_customer_order_csv_export_admin.i18n.export_completed,body:t({export_method:e.method,download_url:e.download_url,mark_as_exported:e.mark_as_exported}),action:wc_customer_order_csv_export_admin.i18n.done}),"download"===e.method&&(window.location.href=e.download_url),k(e.export_id),e.status},y=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=wc_customer_order_csv_export_admin.i18n.unexpected_error,o=wc_customer_order_csv_export_admin.i18n.unexpected_error_message,r=null;if(null!=e){if(null!=e.status)switch(r=e.status,e.status){case"not-found":t=wc_customer_order_csv_export_admin.i18n.export_not_found;break;case"failed":t=wc_customer_order_csv_export_admin.i18n.export_failed;break;case"completed":t="failed"===e.transfer_status?wc_customer_order_csv_export_admin.i18n.export_transfer_failed:wc_customer_order_csv_export_admin.i18n.export_completed}else null!=e.title&&(t=e.title);null!=e.message&&(o=e.message)}return w({title:t,body:'<p><span class="dashicons dashicons-warning"></span> '+o+"</p>",action:wc_customer_order_csv_export_admin.i18n.close}),r},k=function(e){return c.get(ajaxurl,{action:"wc_plugin_framework_customer_order_csv_export_dismiss_notice",messageid:"wc_customer_order_export_finished_"+e})};return wc_customer_order_csv_export_admin.settings_page===pagenow&&("export"!==(t=wc_customer_order_csv_export_admin.current_tab)&&"automations"!==t||c(".js-automation-output-type, .js-automation-export-type, .js-auto-export-trigger").change(function(){var o=c(".js-automation-output-type:checked").val(),r=c(".js-automation-export-type:checked").val(),n=c(".js-auto-export-trigger").val();return c(".js-output-type-field, .js-export-type-field").closest("tr").hide(),c(".js-output-type-field").each(function(e,t){return c(t).hasClass("show_if_"+o)&&(c(t).hasClass("show_if_"+r)||!c(t).hasClass("js-export-type-field"))?c(t).closest("tr").show():void 0}),c(".js-export-type-field").each(function(e,t){return c(t).hasClass("show_if_"+r)&&(c(t).hasClass("show_if_"+o)||!c(t).hasClass("js-output-type-field"))&&(c(t).hasClass("show_if_"+n)||!c(t).hasClass("js-action-field"))?c(t).closest("tr").show():void 0})}).change(),"export"===wc_customer_order_csv_export_admin.current_tab&&(t={dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,showOn:"button",buttonImage:wc_customer_order_csv_export_admin.calendar_icon_url,buttonImageOnly:!0},c("#start_date").datepicker(t),c("#end_date").datepicker(t),c('input[name="type"]').change(function(){var e=c("#subscription_orders").closest("table.form-table").add(c("#subscription_orders").closest("table.form-table").prev("h2"));return"orders"===c(this).val()?e.show():e.hide()}),c("#mainform").submit(function(e){var t,o,r;for(o in e.preventDefault(),e=(t=v(this)).output_type,r={export_type:r=t.type,export_method:"download",output_type:t.output_type,export_format:t[e+"_"+r+"_export_format"],filename:t[e+"_"+r+"_filename"],mark_as_exported:null!=(r=t[r+"_mark_as_exported"])?r:0,batch_enabled:null!=(r=t.enable_batch_processing)?r:0,add_notes:t[e+"_add_notes"]},t)j.call(t,o)&&(t[o],/(?:_mark_as_exported|_export_format|_filename)$/.test(o))&&delete t[o];return delete t.output_type,delete t.type,delete t.add_notes,delete t._wp_http_referer,delete t._wpnonce,h(t,r)})),"export_list"===wc_customer_order_csv_export_admin.current_tab&&(c(".file_actions").find(".delete").on("click",function(e){if(!confirm(wc_customer_order_csv_export_admin.i18n.confirm_export_delete))return e.preventDefault()}),c(".file_actions").find(".cancel").on("click",function(e){if(!confirm(wc_customer_order_csv_export_admin.i18n.confirm_export_cancel))return e.preventDefault()}),c(".file_actions").find(".transfer, .email").on("click",function(e){if(!confirm(wc_customer_order_csv_export_admin.i18n.confirm_export_transfer))return e.preventDefault()}),c(".file_actions").find(".resume").on("click",function(e){if(e.preventDefault(),!c(e.target).hasClass("disabled"))return x(c(e.target).data("export-id"))})),"automations"===wc_customer_order_csv_export_admin.current_tab&&(c(".automation-slider").on("click",function(e){var o,r;return e.preventDefault(),e=c(this).data("automation-id"),o=c(this).siblings("input"),e={action:"wc_customer_order_export_admin_toggle_automation",automation_id:e,new_state:(r=o.is(":checked"))?0:1,nonce:wc_customer_order_csv_export_admin.security.toggle_automation_nonce},c.post(ajaxurl,e).done(function(e){var t=null!=e.data?e.data:wc_customer_order_csv_export_admin.i18n.unexpected_error;return e.success?o.prop("checked",!r):alert(t)}).fail(function(e,t,o){return alert(wc_customer_order_csv_export_admin.i18n.unexpected_error)})}),c(".wp-list-table.automations .actions .delete").on("click",function(e){if(!confirm(wc_customer_order_csv_export_admin.i18n.confirm_delete_automation))return e.preventDefault()}),c(".js-automation-export-type").on("change",function(e){var t=c(".js-automation-export-type:checked").val(),o=c("#statuses.js-export-type-field").closest("table").prev();return"orders"===t?o.show():o.hide()}).change(),e={ftp:c(".js-auto-export-ftp-field:first").closest("table"),http_post:c(".js-auto-export-http-post-field:first").closest("table"),email:c(".js-auto-export-email-field:first").closest("table")},c(".js-auto-export-trigger").change(function(){var e=c(this).val(),t=c(".js-auto-export-schedule-field").closest("tr");return"immediate"===e?t.hide():t.show()}).change(),c(".js-auto-export-method").change(function(){var o=c(this).val();return"local"===o?c(this).next("span.description").show():c(this).next("span.description").hide(),c.each(e,function(e,t){e=e===o?"show":"hide";return t[e]().prev()[e]()})}).change(),c(".js-auto-export-timepicker").timepicker({step:5}),c("select.js-auto-export-ftp-security").change(function(){var e=c(".js-auto-export-ftp-port"),t=Number(e.val(),10),o=c(this).val();if(""===t||-1<[21,22,990].indexOf(t))return"sftp"===o?e.val(22):"ftp_ssl"===o?e.val(990):e.val(21)}).change(),c(".edit-automation-form").closest("form").on("submit",function(e){if("Manual"===c(".js-automation-name").val())return e.preventDefault(),alert(wc_customer_order_csv_export_admin.i18n.automation_name_error)}),c(".js-auto-export-test-button").on("click",function(){return c("<input>").attr({type:"hidden",id:"wc_customer_order_export_test_method",name:"wc_customer_order_export_test_method",value:c(this).data("method")}).appendTo(".woocommerce form")})),"custom_formats"===wc_customer_order_csv_export_admin.current_tab)&&(c(".page-title-action.add-new-custom-format").click(function(e){return e.preventDefault(),w({title:wc_customer_order_csv_export_admin.i18n.add_new_custom_format,body:c("#tmpl-wc-customer-order-coupon-export-modal-body-add-custom-format").html(),action:wc_customer_order_csv_export_admin.i18n.add_new,button_class:"button-primary"}),c(document.body).one("wc_backbone_modal_response.add_new_custom_format",function(e,t,o){return e.preventDefault(),e=null!=o.export_type?o.export_type:"orders",o=null!=o.output_type?o.output_type:"csv",window.location=c(".page-title-action.add-new-custom-format").attr("href")+"&export_type="+e+"&output_type="+o})}),c(".format_actions").find(".delete:not(.disabled)").on("click",function(e){if(!confirm(wc_customer_order_csv_export_admin.i18n.confirm_format_delete))return e.preventDefault()}),wc_customer_order_csv_export_admin.display_load_mapping_modal&&(w({title:wc_customer_order_csv_export_admin.i18n.load_mapping,body:c("#tmpl-wc-customer-order-csv-export-modal-body-load-mapping").html(),action:wc_customer_order_csv_export_admin.i18n.load,button_class:"button-primary"}),c(document.body).one("wc_backbone_modal_response.load_mapping",function(e,t,o){return _(o)})),c(document.body).on("click.wp-toggle-checkboxes","thead .sv-check-column :checkbox, tfoot .sv-check-column :checkbox",function(e){var t=c(this).closest("table"),o=c(this).prop("checked"),r=e.shiftKey||c(this).data("wp-toggle");t.children("tbody").filter(":visible").children().children(".check-column").find(":checkbox").prop("checked",function(){return!c(this).is(":hidden,:disabled")&&(r?!c(this).prop("checked"):!!o)}),t.children("thead, tfoot").filter(":visible").children().children(".check-column").find(":checkbox").prop("checked",function(){return!r&&!!o})}),c(".js-row-type").change(function(){var e=c(".js-show-if-single-order-format").closest("tr"),t=c("select.js-field-key"),o=t.find('option[value="line_items"]'),r=t.find('option[value^="item_"]');return"order"===c(this).val()?(e.show(),o.prop("disabled",!1),r.prop("disabled",!0)):(e.hide(),o.prop("disabled",!0),r.prop("disabled",!1),c("#items_format").val("pipe_delimited").change()),t.not('[name*="[__INDEX__]"]').removeClass("enhanced").select2("destroy"),c(document.body).trigger("wc-enhanced-select-init")}).change(),n=c(".wc-customer-order-csv-export-field-mapping"),o=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],o=n.find(".field-mapping-__INDEX__"),r=n.find("tbody tr").length-2,r=c(o.prop("outerHTML").replace(/__INDEX__/g,r));if(r.find(".enhanced").removeClass("enhanced"),e.key&&(r.find(".js-field-key").val(e.key),"meta"===e.key?(r.find(".js-field-meta-key-label").show(),e.meta_key&&r.find(".js-field-meta-key").val(e.meta_key)):"static"===e.key&&(r.find(".js-field-static-value-label").show(),e.static_value)&&r.find(".js-field-static-value").val(e.static_value)),e.name&&r.find(".js-field-name").val(e.name),o.before(r),n.find(".no-field-mappings").addClass("hide"),n.find("tfoot .js-remove-field-mapping").removeClass("hide"),t)return c(document.body).trigger("wc-enhanced-select-init")},u=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:400,o=(o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)||function(){},r=function(){return n.find("tbody tr:visible").length<1&&(n.find(".no-field-mappings").removeClass("hide"),n.find(".js-remove-field-mapping").addClass("hide")),n.find('th.check-column input[type="checkbox"]').removeAttr("checked")};return t?c.when(c(e).closest("tr.field-mapping").fadeOut(t,function(){var e=c(this);return setTimeout(function(){return e.remove()},1)})).then(function(){return r(),setTimeout(o,1)}):(c(e).closest("tr.field-mapping").remove(),r(),o())},l=function(){var o=0;return n.find("tr.field-mapping").each(function(e,t){if(!c(t).hasClass("field-mapping-__INDEX__"))return c(t).removeClass(function(e,t){var o=new RegExp("field-mapping-([0-9])*","g"),t=t.match(o);if(t)return t[0]}),c(t).addClass("field-mapping-"+o),c("input, select, textarea",t).each(function(e,t){t=jQuery(t);if(t.attr("name"))return t.attr("name",t.attr("name").replace(/\[([^[]*)\]/,"["+o+"]"))}),o++})},r=function(t){return c(".wc-customer-order-csv-export-field-mapping").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),setTimeout(function(){var e;return t="string"==typeof t?JSON.parse(t):t,c(".js-include-all-meta").prop("checked",!0===t.include_all_meta),t.delimiter&&c(".js-row-type").val(t.row_type).trigger("change"),t.row_type&&c(".js-row-type").length&&c(".js-row-type").val(t.row_type).trigger("change"),t.items_format&&c(".js-items-format").length&&c(".js-items-format").val(t.items_format).trigger("change"),u(n.find("tbody tr.field-mapping:not(.field-mapping-__INDEX__)"),!1),e=null!=t.columns?t.columns:null!=t.fields?t.fields:[],e=c.map(e,function(e,t){return(e="string"==typeof e?{name:e}:e).key||(e.key=t),e}),f(e,o,this,function(){return l(),c(document.body).trigger("wc-enhanced-select-init"),c(".wc-customer-order-csv-export-field-mapping").unblock()})},1)},n.find(".js-add-field-mapping").click(function(e){return e.preventDefault(),o({},!0)}),n.find(".js-remove-field-mapping").click(function(e){return e.preventDefault(),e=n.find('tbody input[type="checkbox"]:checked'),u(e,null,l)}),n.find(".js-load-mapping").click(function(e){return e.preventDefault(),w({title:wc_customer_order_csv_export_admin.i18n.load_mapping,body:c("#tmpl-wc-customer-order-csv-export-modal-body-load-mapping").html(),action:wc_customer_order_csv_export_admin.i18n.load,button_class:"button-primary"}),c(document.body).on("wc_backbone_modal_response",function(e,t,o){return _(o)})}),c(document.body).on("change","#load-mapping-source",function(e){return"snippet"===c(e.target).val()?c("#load-mapping-snippet").show():c("#load-mapping-snippet").hide()}),n.find("tbody").sortable({items:"tr",cursor:"move",axis:"y",handle:"td.sort",scrollSensitivity:40,update:l}),n.on("change","select.js-field-key",function(e){var t=c(e.target),o=t.closest("tr").find(".js-field-name"),r=t.closest("td").find(".js-field-meta-key-label"),n=t.closest("td").find(".js-field-static-value-label");if("meta"===t.val()?r.removeClass("hide").find("input").focus():r.addClass("hide").find("input").val(""),"static"===t.val()?n.removeClass("hide").find("input").focus():n.addClass("hide").find("input").val(""),!o.val()||e.removed&&e.removed.id===o.val())return r="meta"===t.val()?"":t.val(),o.val(r)}),c("#mainform").submit(function(e){return c("tr.field-mapping-__INDEX__").remove()})),"edit-shop_order"!==pagenow&&"woocommerce_page_wc-orders"!==pagenow||(d=wc_customer_order_csv_export_admin.hpos_enabled?"#wc-orders-filter":"#posts-filter",a=wc_customer_order_csv_export_admin.hpos_enabled?"order[]":"post[]",c(d+' input[type="submit"].action').on("click",function(e){var t=c(e.target).prev("select").val();if("download_to_csv"===t||"download_to_xml"===t||"export_and_send"===t)return e.preventDefault(),e=c.map(c(d).find('input[name="'+a+'"]:checked'),function(e){return Number(c(e).val(),10)}),"export_and_send"===t?i("orders",e):"download_to_csv"===t?s("orders","csv",e):"download_to_xml"===t?s("orders","xml",e):void 0}),c(".order_actions .download_to_csv, .wc_actions .download_to_csv").on("click",function(e){var t;return e.preventDefault(),e={export_type:"orders",export_method:"download",output_type:"csv"},t=c(this).closest("tr").find('th input[name="'+a+'"]').val(),h({ids:t},e)}),c(".order_actions .download_to_xml, .wc_actions .download_to_xml").on("click",function(e){var t;return e.preventDefault(),e={export_type:"orders",export_method:"download",output_type:"xml"},t=c(this).closest("tr").find('th input[name="'+a+'"]').val(),h({ids:t},e)})),"shop_order"!==pagenow&&"woocommerce_page_wc-orders"!==pagenow||(t=wc_customer_order_csv_export_admin.hpos_enabled?"form#order":"form#post",c(t).submit(function(e){var t=c(this).find('select[name="wc_order_action"]').val();if(t&&("wc_customer_order_export_csv_download"===t||"wc_customer_order_export_xml_download"===t||"wc_customer_order_export_and_send"===t))return e.preventDefault(),e=[woocommerce_admin_meta_boxes.post_id],"wc_customer_order_export_and_send"===t?i("orders",e):"wc_customer_order_export_csv_download"===t?s("orders","csv",e):"wc_customer_order_export_xml_download"===t?s("orders","xml",e):void 0})),"users"===pagenow&&c(".bulkactions #doaction").on("click",function(e){var t=c(e.target).prev("select").val();if("download_to_csv"===t||"download_to_xml"===t||"export_and_send"===t)return e.preventDefault(),e=c.map(c(".wp-list-table.users").find('input[name="users[]"]:checked'),function(e){return Number(c(e).val(),10)}),"export_and_send"===t?i("customers",e):"download_to_csv"===t?s("customers","csv",e):"download_to_xml"===t?s("customers","xml",e):void 0}),i=function(r,n){var e=wp.template("wc-customer-order-export-modal-body-automated-action");return w({title:wc_customer_order_csv_export_admin.i18n.automation_action_title,body:e(),cancel:wc_customer_order_csv_export_admin.i18n.cancel,action:wc_customer_order_csv_export_admin.i18n.send,button_class:"button-primary send-export"}),c(document.body).one("wc_backbone_modal_response.handle_automation_action",function(e,t,o){if(o.automation_action_id)return o={export_type:r,export_method:"auto_export",automation_id:o.automation_action_id},h({ids:n},o)})},s=function(r,n,a){var e=wp.template("wc-customer-order-export-modal-body-download-action"),t="csv"===n?wc_customer_order_csv_export_admin.i18n.download_csv_action_title:wc_customer_order_csv_export_admin.i18n.download_xml_action_title;return w({title:t,body:e({output_type:n}),cancel:wc_customer_order_csv_export_admin.i18n.cancel,action:wc_customer_order_csv_export_admin.i18n.download,button_class:"button-primary download-export"}),window.wc_customer_order_csv_export_admin.manual_export_settings[n][r].export_format&&((t=window.wc_customer_order_csv_export_admin.manual_export_settings[n][r]).export_format&&c("#js-download-action-export-format").val(t.export_format),t.filename&&c("#js-download-action-filename").val(t.filename),t.add_notes?c("#js-download-action-add-notes").prop("checked",!0):c("#js-download-action-add-notes").removeProp("checked"),t.batch_enabled?c("#js-download-action-batch-processing").prop("checked",!0):c("#js-download-action-batch-processing").removeProp("checked")),c(document.body).one("wc_backbone_modal_response.handle_download_action",function(e,t,o){if(o.download_action_export_format)return o={export_type:r,output_type:n,export_method:"download",export_format:o.download_action_export_format,filename:o.download_action_filename,add_notes:o.download_action_add_notes,batch_enabled:o.download_action_enable_batch_processing},window.wc_customer_order_csv_export_admin.manual_export_settings[n][r]=o,h({ids:a},o)})},_=function(e){var t="snippet"===e.source?e.snippet?JSON.parse(e.snippet):{columns:{}}:"empty"===e.source?{columns:{}}:wc_customer_order_csv_export_admin.export_formats[e.source];if(t)return setTimeout(function(){return r(t)},1)},c(document.body).on("wc_backbone_modal_before_remove",function(){var e;if(c(document.body).off("wc_backbone_modal_response.handle_automation_action"),c(document.body).off("wc_backbone_modal_response.handle_download_action"),c(document.body).off("wc_backbone_modal_response.add_new_custom_format"),(e=c("#wc-backbone-modal-dialog").data("wc-customer-order-csv-export-id"))&&p[e])return clearInterval(p[e])})})}.call(void 0);